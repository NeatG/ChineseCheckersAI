// Group 2:
// Mohammed Bellifa and Stephen Fleming
//
// debugFlag global variable is below. Setting this to true verifies the alpha-beta utilizing minimax against the transposition table and it verifies the alpha beta search against a regular minimax search.
#include <cstddef>

#include "Agent.h"
#include "ChineseCheckersState.h"
#include <chrono>
#include <iostream>
#include <sstream>
#include "DistanceStateEvaluator.h"
#include "TDLambdaStateEvaluator.h"
#include "ZobristHash.h"
#include "TranspositionTable.h"

bool debugFlag = false; //Global debug flag, turning this on will cause the agent to no longer work within 10 seconds and will cause it to double check values from multiple functions (slow).

//This stringstream is used to print debug information _after_ the move timer has completed so that long debug messages don't disadvantage the agent.
std::stringstream debugStream;

int main(int /*argc*/, char **/*argv*/) {
    ZobristHashSetup();
    TranspositionTableSetup();
/*  Debugs the ZHash implementation by testing the incremental version vs. creating the whole hash at once and printing out hte results.
    DebugZHash();
 */
    Agent a;
    //DistanceStateEvaluator distanceStateEval;
    TDLambdaStateEvaluator tdlambda;
    std::vector<double> weights = {-0.307312, -0.339539, -0.251665, -0.246691, -0.250036, -0.135097, -0.0990512, -0.0858252, -0.131595, -0.218764, -0.201225, -0.314214, -0.24741, -0.21092, -0.165623, -0.0823553, -0.102514, -0.30157, -0.331962, -0.117086, -0.108304, -0.0137429, -0.0850764, -0.118107, -0.0692807, -0.0670176, -0.110714, -0.134626, -0.177352, -0.179839, -0.000430668, 0.128354, -0.0151272, 0.209483, 0.000325294, -0.140233, -0.130799, -0.238712, -0.114207, -0.126015, 0.0276815, 0.209766, 0.0936781, -0.113975, 0.0863978, -0.0966484, -0.0365608, -0.051896, -0.0202094, 0.0709003, -0.0128015, -0.0310936, -0.0132754, -0.0246654, 0.0563962, -0.094141, -0.0873183, -0.0152764, -0.0390265, 0.140753, 0.088226, 0.214345, 0.176518, -0.260114, -0.107073, 0.111228, 0.213045, 0.123676, 0.190296, 0.166669, 0.291352, 0.192827, -0.116173, 0.126329, 0.0325726, 0.0752927, 0.117878, 0.0304552, 0.117813, 0.317331, 0.330105, -0.31682, -0.257699, -0.175377, -0.193978, -0.258031, -0.287641, -0.227428, -0.17926, -0.0455592, -0.204188, -0.247275, -0.228036, -0.213404, -0.238054, -0.297307, -0.139975, 0.00169132, 0.164315, -0.19087, -0.183224, -0.134154, -0.0941036, -0.0543402, -0.131445, -0.00915771, -0.0299467, -0.250968, -0.0102699, -0.0389637, -0.107051, -0.0381127, -0.132504, -0.0954712, -0.0500832, -0.0583592, -0.0297679, -0.133018, -0.0737002, -0.0860168, -0.103919, -0.0735202, -0.0349269, -0.00116318, 0.0777224, -0.0142916, -0.0250995, -0.18501, -0.229796, 0.00739241, -0.156338, -0.0343058, 0.066664, 0.0259689, 0.196007, -0.031733, -0.0832626, -0.0410458, 0.0708851, 0.038052, -0.00951905, 0.0522875, 0.076652, 0.454161, 0.0333682, -0.0337209, 0.0553117, 0.0712813, 0.0459244, 0.0418212, 0.139175, 0.198034, 0.149187, 0.0161972, 0.00322443, -0.0137535, 0.142816, 0.118163, 0.20507, 0.221011, 0.272536, 0.417454, 0.0136574, -0.00480642, -0.0388088, 0.0690207, 0, 0.0267082, 0, -0.019877, 0.0804086, -0.0975693, 0.131852, -0.0933368, -0.0112514, 0.0472635, -0.106466, 0.0371236, -0.0654561, 0.0616517, -0.044166, -0.111223, 0, -0.00465327, 0, -0.0410057, 0, -0.0442675, 0.0022948, -0.0616278, 0.125725, -0.11433, 0.0950133, -0.0685656, 0.120454, -0.127299, 0.0954946, -0.0523553, -0.0522871, -0.0787459, -0.0156801, 0.0731118, -0.0551317, -0.0890714, 0.0630019, -0.0940528, -0.0150442, 0.0330585, -0.0380813, 0.205182, -0.0390366, 0.135589, -0.0184963, -0.0784696, -0.0429355, -0.0711114, 0.0470768, -0.0697026, -0.0193403, -0.170774, -0.0421136, -0.0907229, -0.00142528, 0.0276121, 0.0773191, -0.0581336, 0.0755487, 0.0960355, 0.0418401, 0.0749683, -0.0511002, 0.181255, 0.00518918, 0.0831398, 0.0572717, 0.172451, 0.00569706, -0.032718, 0.0448265, -0.01899, -0.0951905, -0.0361693, 0.0285242, 0.10245, 0.0336272, 0.000979215, 0.00470545, 0.0283849, 0.163643, -0.0550888, 0.0999119, -0.0148756, -0.078249, -0.0454923, -0.00564781, -0.0482844, -0.0355662, 0.0521989, -0.0170859, -0.0570891, -0.162989, 0.0265335, 0.015598, 0.0476615, -0.0447007, 0.00124038, 0.123122, 0.058648, 0.0665888, 0.139451, 0.0350272, 0.0764345, 0.121428, -0.0502383, 0.104392, -0.0490058, 0.0658517, -0.0337324, 0.0972609, -0.0335271, -0.00414324, 0.0721782, -0.0733308, -0.0105934, -0.000802593, -0.156304, 0.00830996, 0.0143513, 0.022552, -0.0604361, -0.0789304, -0.0475662, -0.0519334, 0.0247742, -0.133525, 0.0259198, -0.0582407, 0.0653129, -0.0120914, -0.0744911, -0.00788297, -0.0357588, -0.014324, -0.0480236, 0.00838003, -0.017449, -0.0084928, -0.00859793, -0.0187887, 0.000143227, -0.0383037, -0.11407, -0.0129775, 0.0153119, 0.018515, -0.0327658, -0.130841, 0.105574, -0.0351979, -0.0173536, -0.0820133, -0.005073, -0.00658115, 0.0848818, -0.159796, 0.0940308, -0.1107, -0.0243591, -0.0686062, 0.0167907, -0.0391212, 0.0504144, -0.00933294, -0.0334685, 0.0840566, -0.0480006, 0.0645685, 0.0521992, -0.0547975, 0.00692723, -0.0879504, 0.0659128, -0.065579, 0.090162, -0.0372991, 0.00236419, -0.0553924, 0.0298406, -0.0753056, 0.0551612, 0.00899083, 0.095583, 0.0553231, -0.0260103, -0.0753491, 0.067999, 0.0627634, -0.0944945, -0.016428, -0.0853318, 0.0076325, -0.061828, -0.0291326, -0.0416199, 0.0536789, 0.0545289, -0.0416361, -0.0284206, 0.0461199, -0.0200101, -0.0968656, -0.013937, 0.0276713, 0.0340135, -0.0262345, -0.0122204, -0.0453798, 0.0201679, 0.0134225, -0.0479226, 0.098477, -0.0827848, 0.0295672, -0.038512, -0.0549406, -0.0570912, 0.00117258, 0.0458194, 0.064772, 0.032736, 0.0879961, -0.143343, -0.0413863, -0.00623079, -0.0208585, 0.0208549, -0.0484931, -0.0497728, 0.033489, 0.0631531, -0.132639, -0.00699647, 0.000194926, -0.0179588, -0.020438, -0.0151278, -0.0453281, -0.0414926, 0.0134023, -0.0642796, 0.0133997, -0.0339204, 0.0830146, -0.0150866, 0.0502828, -0.0154588, 0.0526846, -0.0164949, -0.0457501, 0.00220467, -0.0294932, -0.0525256, -0.111636, -0.010825, -0.10419, -0.0732823, -0.0145841, -0.00193477, -0.025885, -0.0174265, 0.0074644, -0.0291568, -0.0242788, -0.0169375, -0.00940051, -0.142512, -0.00128107, 0.0239121, 0.0174895, -0.0349941, 0.045259, 0.122356, 0.0288982, -0.0751834, 0.00868598, -0.0200965, -0.0891347, 0.0441362, -0.021247, 0.0485725, -0.0914174, 0.00167017, -0.0293001, -0.0753028, -0.0685989, 0.122809, -0.00613777, 0.0911504, -0.0612803, 0.000251943, -0.00689913, -0.129751, -0.00026794, -0.0824694, 0.0195203, -0.10425, 0.0515087, -0.176154, 0.0959838, -0.136413, 0.0725585, 0.0180578, 0.00620325, 0.0498458, 0.0770643, 0.072464, 0.352128, -0.033051, 0.0257144, 0.127698, -0.064539, 0.00924901, -0.119315, 0.0165828, -0.276684, -0.00603578, -0.0997844, 0.0565853, -0.0287549, 0.0526295, -0.0354316, 0.0720417, 0.218457, 0.0258621, -0.0462868, 0.005526, 0.0848274, -0.000959499, 0.0286217, -0.0458084, -0.1003, -0.112758, -0.00574025, 0.0690669, -0.132724, -0.0966278, -0.0953216, -0.0777901, -0.152025, 0.0369261, 0.0120302, -0.0308322, -0.0086464, 0, -0.0200253, -0.0339652, 0.20782, 0.149128, 0.0475037, -0.023637, 0.0700339, -0.0114372, -0.0762299, 0, -0.046445, 0, -0.0211871, 0.027737, 0.0649743, 0.0483186, 0.169965, -0.132036, 0.0762841, 0.188944, 0.0107483, 0.016851, -0.00514356, -0.0170721, 0.00437153, 0.0927282, 0.0525952, 0.117036, -0.0610809, -0.0833585, -0.0623507, 0, -0.0523989, 0, 0.0296577, -0.0716421, -0.0477695, 0.111966, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.315059};
    //1k {-0.10626, -0.0308577, -0.176937, -0.0747788, -0.304988, -0.260683, -0.231701, -0.234277, -0.0916348, -0.143798, -0.135961, -0.123423, -0.2069, -0.220467, -0.125136, -0.284035, -0.0919328, -0.232242, -0.0979604, -0.235122, -0.18603, -0.175754, -0.165055, -0.103447, -0.293006, -0.0967909, -0.126626, -0.0418476, -0.0652479, 0.0131758, -0.104746, -0.040458, -0.053251, -0.00624045, -0.0157353, -0.120184, -0.0521137, 0.0564594, 0.0355555, -0.0593296, 0.0570327, 0.015272, -0.0139272, -0.0858695, -0.153108, -0.128463, -0.103279, 0.026232, 0.0134361, 0.0570071, 0.15214, 0.00287959, -0.104128, 0.153942, -0.102995, 0.00691352, -0.0396029, 0.0126791, 0.0896585, 0.0208399, 0.0709508, 0.143894, 0.181534, -0.103791, -0.123866, -0.0576288, 0.0651461, 0.0437666, 0.378119, 0.143271, 0.170507, 0.22449, -0.0160526, -0.104254, -0.112591, -0.0915963, 0.126437, 0.0917589, 0.141344, 0.428436, 0.456927, -0.259834, -0.397611, -0.0574477, -0.0740054, -0.126691, -0.0571619, -0.0718732, 0.069023, -0.0510047, -0.241298, -0.228898, -0.195735, -0.44375, -0.144494, -0.205423, -0.101187, -0.0116855, 0.0320139, -0.198516, -0.248748, -0.181105, -0.130038, -0.174645, -0.209667, -0.083935, -0.133839, -0.0796902, -0.12878, -0.0356585, -0.12438, -0.160053, -0.0838965, -0.0898931, -0.0674516, 0.00831918, 0.000949315, 0.184113, 0.0998466, -0.0278916, -0.0571828, -0.100383, -0.0768207, -0.0847736, -0.0431913, 0.0518947, 0.0395258, 0.00826153, -0.0519242, -0.0155995, -0.00487785, -0.0510313, -0.00719327, 0.0370477, 0.0575708, -0.0459084, 0.0720192, 0.052462, 0.0683711, 0.0938184, -0.0329154, 0.00154418, 0.142704, 0.160727, -0.020748, 0.00323561, 0.0745941, 0.0600552, 0.0480623, -0.00526027, 0.00842572, 0.0462194, 0.200418, 0.00838664, 0.0922722, 0.0133395, 0.0526866, 0.0777348, 0.0210725, 0.107699, 0.091063, 0.262317, 0.0984011, -0.100789, -0.0393306, -0.170972, 0, -0.148747, 0, 0.120949, -0.0382245, 0.111868, -0.0747383, -0.0628558, 0.224285, -0.0646363, 0.0882587, -0.0564182, -0.0113136, -0.0785497, -0.0709366, -0.0875895, 0, -0.0187617, 0, -0.0772128, 0, 0.148509, -0.0295367, 0.00219618, 0.0540723, -0.10763, 0.0856579, 0.0166594, 0.0375549, -0.0987766, -0.00853636, -0.0288035, -0.022443, 0.0552693, -0.0618408, 0.136352, -0.0984104, 0.0549427, 0.0164862, -0.249166, -0.0423144, -0.136209, 0.086908, 0.00117013, 0.149054, 0.0388381, 0.0867592, 0.146309, -0.0526833, 0.0575708, 0.0109386, -0.000369369, -0.0170696, 0.0982263, -0.0698247, -0.1324, 0.0233674, -0.0645636, 0.0208024, 0.0588978, 0.0189239, 0.00930441, 0.0798451, -0.190165, -0.0971908, -0.107644, -0.0205457, 0.0244145, -0.00353043, 0.0762276, -0.0311459, 0.000570406, -0.125276, 0.0210067, -0.0191095, 0.0809356, 0.0347359, 0.0188278, -0.0858354, 0.0586298, -0.0442933, 0.0223792, -0.0311168, 0.000622223, -0.0995652, 0.0568727, 0.103891, 0.049954, 0.0710025, -0.0105542, 0.0482618, 0.00265245, 0.0964268, 0.0043435, -0.125914, 0.00907897, -0.0431539, 0.097248, 0.107652, -0.0435148, 0.00485546, 0.032192, 0.0988271, 0.0219898, -0.0340701, 0.122537, 0.013005, 0.0556441, 0.0966309, -0.0182794, -0.0129782, -0.023375, 0.0416518, 0.0677786, -0.0254091, 0.010202, -0.00703632, -0.0933302, -0.0200461, -0.136281, -0.0156224, -0.115026, 0.0273681, -0.0640494, -0.0206715, -0.0163186, 0.00526191, 0.0883266, -0.0455522, -0.00429178, 0.0517296, -0.00972024, -0.0214904, -0.0371263, 0.0234202, -0.0430464, 0.00439317, 0.00235072, 0.0420036, -0.0385473, 0.143466, 0.00561771, -0.0248638, 0.0560428, 0.059804, 0.00995227, 0.0209874, 0.0213215, -0.0871889, -0.00503968, -0.00366157, -0.0325815, 0.00646073, 0.0254357, -0.0256012, -0.0386428, -0.0850098, 0.0342093, -0.049594, -0.0321476, -0.0129907, 0.0500849, -0.0615315, -0.0144187, 0.00398896, -0.0861605, -0.00803463, -0.0117209, 0.0974328, -0.00563298, -0.0977181, -0.00316577, -0.112597, -0.00582655, -0.00527854, 0.0693542, -0.0743192, -0.0115288, 0.0792183, 0.0382977, -0.0497322, -0.0505513, -0.098481, 0.0870966, 0.0635809, -0.0371074, 0.0396553, 0.000503348, -0.0174197, 0.0393061, 0.027379, 0.0472621, 0.0141796, -0.0233498, -0.00614461, -0.0505338, -0.0176508, 0.0423371, -0.000648645, -0.0190418, -0.00222648, -0.163586, -0.00795095, -0.117142, 0.0121303, 0.0794406, -0.00638746, -0.00236257, 0.00057556, -0.0445885, 0.0115133, -0.0618209, 0.0353363, 0.054402, 0.0407064, -0.0410369, -0.0446276, -0.0304017, 0.043324, -0.0132743, -0.0222928, 0.00377188, -0.0125677, -0.0472697, -0.0744837, 0.00298419, 0.0623227, 0.00484362, 0.0560052, -0.0348444, -0.151307, -0.125009, -0.00727838, -0.0188575, -0.115966, 0.0080745, -0.0492909, 0.0428129, 0.0178766, -0.0286914, -0.0996079, -0.011349, -0.231796, -0.0746926, -0.0218745, 0.011571, -0.0672697, 0.0509244, -0.0469565, 0.0426218, -0.0282156, 0.0583637, 0.0745733, 0.0183448, -0.0608353, 0.0647805, -0.0411538, 0.00631525, 0.0579191, -0.0535768, 0.0479212, -0.113065, -0.151655, -0.0619827, -0.030195, 0.0374089, -0.078758, -0.0554199, 0.0877752, -0.1963, 0.0390116, -0.0731473, -0.0133497, 0.0173833, 0.018613, 0.0131821, 0.0735432, 0.0623472, 0.0812197, 0.0326162, 0.0122176, -0.103329, 0.0277811, -0.0103798, -0.0432705, 0.111433, 0.0540234, 0.0155133, 0.0477726, 0.0511839, -0.00544225, 0.0349282, -0.0155067, -0.0405894, 0.0687599, 0.0990112, 0.0100502, -0.0317419, 0.0775902, 0.0362472, -0.0407597, -0.18754, 0.00881836, -0.103873, -0.00665924, -0.0449585, 0.103075, -0.0253164, -0.159253, 0.00512731, 0.182445, 0.0142648, -0.094364, -0.0961875, 0.0566092, 0.0543459, 0.0639777, 0.12683, -0.230088, -0.0688927, -0.150185, 0.011468, -0.061934, 0.0555681, -0.0535185, -0.0525957, 0.0364608, -0.0564025, 0.00706852, -0.0467576, -0.0745022, 0.0609301, -0.0348683, 0.0264738, -0.0261668, 0.141295, 0.0950021, 0.025084, 0.0378044, 0.00538242, -0.181203, 0.0429488, -0.0898225, -0.00469212, -0.0190453, -0.00209195, 0.0223623, 0, -0.0466591, 0.00776108, 0.0331372, 0.0351116, -0.142859, 0.133825, 0.0920819, 0.192408, -0.0421784, 0, -0.130716, 0, 0.0272195, -0.118106, -0.0145996, -0.00221488, 0.0311833, -0.0294969, 0.0405092, 0.020661, -0.0382599, 0.0710335, -0.043983, -0.0575479, 0.0195603, 0.137688, 0.0330027, 0.0892621, 0.00877377, -0.0800402, 0.0311398, 0, -0.0218394, 0, 0.042198, 0.00479783, 0.0469706, 0.0554721, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.30763};
    //tdlambda.train(100000);
    tdlambda.setWeights(weights);
    //a.setEvaluator(&distanceStateEval);
    a.setEvaluator(&tdlambda);
    a.playGame();
    return EXIT_SUCCESS;
}
